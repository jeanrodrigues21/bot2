<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Dashboard</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>Trading Bot Dashboard <span id="statusIndicator" class="status-indicator status-stopped"></span></h1>
                <p>Controle e monitoramento em tempo real - MODO PRODU√á√ÉO</p>
            </div>
            <button id="themeToggle" class="theme-toggle">üåô Tema Dark</button>
        </div>

        <div id="connectionStatus" class="connection-status disconnected">Desconectado</div>

        <div id="alertContainer"></div>

        <div class="dashboard-grid">
            <!-- Controles -->
            <div class="card">
                <h3>Controles do Bot</h3>
                <div class="controls">
                    <button id="startBtn" class="btn btn-start">Iniciar Bot</button>
                    <button id="stopBtn" class="btn btn-stop">Parar Bot</button>
                    <button id="forceCheckBtn" class="btn btn-secondary">Verifica√ß√£o For√ßada</button>
                    <button id="closePositionsBtn" class="btn btn-secondary">Fechar Posi√ß√µes</button>
                    <button id="configBtn" class="btn btn-secondary">‚öôÔ∏è Configura√ß√µes</button>
                </div>
                <div class="loading" id="controlsLoading" style="display: none;">
                    <div class="spinner"></div>
                    Processando...
                </div>
            </div>

            <!-- Status Geral -->
            <div class="card">
                <h3>Status Geral</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="currentPrice">$ 0.00</div>
                        <div class="stat-label">Pre√ßo Atual</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="dailyTrades">0</div>
                        <div class="stat-label">Trades Hoje</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalProfit">$ 0.00</div>
                        <div class="stat-label">Lucro Total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="activeCoin">-</div>
                        <div class="stat-label">Moeda Ativa</div>
                    </div>
                </div>
            </div>

            <!-- Saldos -->
            <div class="card">
                <h3>Saldos</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="usdtBalance">$ 0.00</div>
                        <div class="stat-label">Saldo USDT</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="btcBalance">0.00000000</div>
                        <div class="stat-label">Saldo BTC</div>
                    </div>
                </div>
                <button id="refreshBalanceBtn" class="btn btn-secondary" style="margin-top: 15px; width: 100%;">Atualizar Saldos</button>
            </div>

            <!-- Posi√ß√µes Abertas -->
            <div class="card">
                <h3>Posi√ß√µes Abertas</h3>
                <div id="positionsList" class="positions-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        Carregando posi√ß√µes...
                    </div>
                </div>
            </div>

            <!-- CORRIGIDO: Varia√ß√£o Di√°ria Inteligente -->
            <div class="card">
                <h3>Varia√ß√£o da Moeda Ativa</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="dailyLow">$ 0.00</div>
                        <div class="stat-label">M√≠nima</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="dailyHigh">$ 0.00</div>
                        <div class="stat-label">M√°xima</div>
                    </div>
                </div>
            </div>

            <!-- NOVO: Moedas Monitoradas (Trading Din√¢mico) -->
            <div class="card" id="monitoredCoinsCard" style="display: none;">
                <h3>Top 10 Moedas Monitoradas</h3>
                <div id="monitoredCoinsList" class="monitored-coins-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        Carregando moedas...
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 12px; color: var(--text-secondary); text-align: center;">
                    Ordenadas por volume de negocia√ß√£o
                </div>
            </div>
        </div>

        <!-- Modal de Configura√ß√µes -->
        <div id="configModal" class="config-modal">
            <div class="config-content">
                <div class="config-header">
                    <h3>Configura√ß√µes do Bot</h3>
                    <button id="configCloseBtn" class="config-close">&times;</button>
                </div>
                
                <div class="config-tabs">
                    <button class="tab-btn active" data-tab="trading">Trading</button>
                    <button class="tab-btn" data-tab="strategies">Estrat√©gias</button>
                    <button class="tab-btn" data-tab="api">API Binance</button>
                    <button class="tab-btn" data-tab="advanced">Avan√ßado</button>
                </div>

                <form id="configForm" class="config-form">
                    <!-- Aba Trading -->
                    <div class="tab-content active" id="trading-tab">
                        <h4>Configura√ß√µes de Trading</h4>
                        
                        <div class="form-group">
                            <label for="tradingMode">Modo de Trading</label>
                            <select id="tradingMode">
                                <option value="single">Moeda √önica</option>
                                <option value="dynamic">Trading Din√¢mico</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="singleSymbolGroup">
                            <label for="symbol">Par de Trading</label>
                            <select id="symbol">
                                <option value="BTCUSDT">BTC/USDT</option>
                                <option value="ETHUSDT">ETH/USDT</option>
                                <option value="BNBUSDT">BNB/USDT</option>
                                <option value="ADAUSDT">ADA/USDT</option>
                                <option value="SOLUSDT">SOL/USDT</option>
                                <option value="XRPUSDT">XRP/USDT</option>
                                <option value="DOTUSDT">DOT/USDT</option>
                                <option value="DOGEUSDT">DOGE/USDT</option>
                                <option value="AVAXUSDT">AVAX/USDT</option>
                                <option value="MATICUSDT">MATIC/USDT</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="dynamicCoinsGroup" style="display: none;">
                            <label for="dynamicCoins">Top 10 Moedas para Trading Din√¢mico</label>
                            <div class="dynamic-coins-selector">
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-BTCUSDT" value="BTCUSDT" checked>
                                    <label for="coin-BTCUSDT">BTC/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-ETHUSDT" value="ETHUSDT" checked>
                                    <label for="coin-ETHUSDT">ETH/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-BNBUSDT" value="BNBUSDT" checked>
                                    <label for="coin-BNBUSDT">BNB/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-ADAUSDT" value="ADAUSDT" checked>
                                    <label for="coin-ADAUSDT">ADA/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-SOLUSDT" value="SOLUSDT" checked>
                                    <label for="coin-SOLUSDT">SOL/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-XRPUSDT" value="XRPUSDT" checked>
                                    <label for="coin-XRPUSDT">XRP/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-DOTUSDT" value="DOTUSDT" checked>
                                    <label for="coin-DOTUSDT">DOT/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-DOGEUSDT" value="DOGEUSDT" checked>
                                    <label for="coin-DOGEUSDT">DOGE/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-AVAXUSDT" value="AVAXUSDT" checked>
                                    <label for="coin-AVAXUSDT">AVAX/USDT</label>
                                </div>
                                <div class="coin-checkbox">
                                    <input type="checkbox" id="coin-MATICUSDT" value="MATICUSDT" checked>
                                    <label for="coin-MATICUSDT">MATIC/USDT</label>
                                </div>
                            </div>
                            <small style="color: var(--text-secondary); font-style: italic; margin-top: 8px; display: block;">
                                üí° O bot monitorar√° todas as moedas selecionadas e operar√° automaticamente na primeira que atender aos crit√©rios de compra
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="tradeAmountPercent">Porcentagem do Saldo por Trade (%)</label>
                            <input type="number" id="tradeAmountPercent" step="0.1" min="0.1" max="100" value="10">
                            <small style="color: var(--text-secondary); font-style: italic; margin-top: 4px; display: block;">
                                üí° Porcentagem do saldo USDT total a ser usado em cada trade (1% a 100%)
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="minTradeAmountUsdt">Valor M√≠nimo por Trade (USDT)</label>
                            <input type="number" id="minTradeAmountUsdt" step="0.01" min="1" value="5">
                            <small style="color: var(--text-secondary); font-style: italic; margin-top: 4px; display: block;">
                                Valor m√≠nimo em USDT mesmo que a porcentagem resulte em menos
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="maxTradeAmountUsdt">Valor M√°ximo por Trade (USDT)</label>
                            <input type="number" id="maxTradeAmountUsdt" step="0.01" min="10" value="10000">
                            <small style="color: var(--text-secondary); font-style: italic; margin-top: 4px; display: block;">
                                Valor m√°ximo em USDT mesmo que a porcentagem resulte em mais
                            </small>
                        </div>
                        
                        <div class="trade-preview" style="margin-top: 15px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border-color);">
                            <h5 style="margin-bottom: 8px; color: var(--text-primary); font-size: 14px;">Pr√©via do Valor de Trade:</h5>
                            <div id="tradePreview" style="font-size: 13px; color: var(--text-secondary);">
                                Configure os valores acima para ver a pr√©via
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dailyProfit">Meta Lucro Di√°rio (%)</label>
                            <input type="number" id="dailyProfit" step="0.01" min="0.1" max="10">
                        </div>
                        <div class="form-group">
                            <label for="stopLoss">Stop Loss (%)</label>
                            <input type="number" id="stopLoss" step="0.01" min="0.1">
                        </div>
                        <div class="form-group">
                            <label for="maxTrades">M√°x. Trades/Dia</label>
                            <input type="number" id="maxTrades" min="1">
                        </div>
                        <div class="form-group">
                            <label for="minPriceChange">Min. Mudan√ßa Pre√ßo (%)</label>
                            <input type="number" id="minPriceChange" step="0.01" min="0.01">
                        </div>
                    </div>

                    <!-- NOVA ABA: Estrat√©gias -->
                    <div class="tab-content" id="strategies-tab">
                        <h4>Aloca√ß√£o de Estrat√©gias</h4>
                        
                        <div class="form-group">
                            <label for="enableReinforcement">
                                <input type="checkbox" id="enableReinforcement" checked>
                                Habilitar Estrat√©gia de Refor√ßo
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label for="originalStrategyPercent">Estrat√©gia Original (%)</label>
                            <input type="number" id="originalStrategyPercent" min="10" max="90" value="70">
                            <small>Porcentagem do saldo para a estrat√©gia principal</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="reinforcementStrategyPercent">Estrat√©gia de Refor√ßo (%)</label>
                            <input type="number" id="reinforcementStrategyPercent" min="10" max="90" value="30" readonly>
                            <small>Porcentagem do saldo para compras de refor√ßo</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="reinforcementTrigger">Trigger de Refor√ßo (%)</label>
                            <input type="number" id="reinforcementTrigger" step="0.1" min="0.5" max="5" value="1.0">
                            <small>Queda percentual que ativa compra de refor√ßo</small>
                        </div>
                        
                        <div class="allocation-preview">
                            <h5>Pr√©via de Aloca√ß√£o (baseado em $1000 USDT):</h5>
                            <div class="allocation-item">
                                <span>Estrat√©gia Original:</span>
                                <span id="previewOriginal">$700.00</span>
                            </div>
                            <div class="allocation-item">
                                <span>Estrat√©gia de Refor√ßo:</span>
                                <span id="previewReinforcement">$300.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Aba API Binance -->
                    <div class="tab-content" id="api-tab">
                        <h4>Credenciais da API Binance</h4>
                        <div class="form-group">
                            <label for="apiKey">API Key</label>
                            <input type="password" id="apiKey" placeholder="Sua API Key da Binance">
                        </div>
                        <div class="form-group">
                            <label for="apiSecret">Secret Key</label>
                            <input type="password" id="apiSecret" placeholder="Sua Secret Key da Binance">
                        </div>
                        <div class="form-group">
                            <label for="baseUrl">URL Base da API</label>
                            <select id="baseUrl">
                                <option value="https://api.binance.com">Produ√ß√£o (api.binance.com)</option>
                                <option value="https://testnet.binance.vision">Testnet (testnet.binance.vision)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Aba Avan√ßado -->
                    <div class="tab-content" id="advanced-tab">
                        <h4>Configura√ß√µes Avan√ßadas</h4>
                        <div class="form-group">
                            <label for="buyThresholdFromLow">Threshold de Compra da M√≠nima (%)</label>
                            <input type="number" id="buyThresholdFromLow" step="0.01" min="0.01">
                        </div>
                        <div class="form-group">
                            <label for="minHistoryForAnalysis">Min. Hist√≥rico para An√°lise</label>
                            <input type="number" id="minHistoryForAnalysis" min="10">
                        </div>
                        <div class="form-group">
                            <label for="recentTrendWindow">Janela de Tend√™ncia Recente</label>
                            <input type="number" id="recentTrendWindow" min="5">
                        </div>
                        <div class="form-group">
                            <label for="buyCooldownSeconds">Cooldown de Compra (segundos)</label>
                            <input type="number" id="buyCooldownSeconds" min="60">
                        </div>
                        <div class="form-group">
                            <label for="pricePollInterval">Intervalo de Polling (segundos)</label>
                            <input type="number" id="pricePollInterval" min="5">
                        </div>
                        <div class="form-group">
                            <label for="logFrequency">Frequ√™ncia de Log</label>
                            <input type="number" id="logFrequency" min="10">
                        </div>
                        <div class="form-group">
                            <label for="makerFee">Taxa Maker (%)</label>
                            <input type="number" id="makerFee" step="0.001" min="0">
                        </div>
                        <div class="form-group">
                            <label for="takerFee">Taxa Taker (%)</label>
                            <input type="number" id="takerFee" step="0.001" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="buyOnDropPercent">Queda da M√°xima para Compra (%)</label>
                            <input type="number" id="buyOnDropPercent" step="0.1" min="0.1" max="5" value="0.7">
                            <small style="color: var(--text-secondary); font-style: italic; margin-top: 4px; display: block;">
                                Nova estrat√©gia: comprar quando o pre√ßo cair X% da m√°xima di√°ria
                            </small>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-secondary" style="width: 100%; margin-top: 20px;">Salvar Configura√ß√µes</button>
                </form>
            </div>
        </div>

        <!-- Logs -->
        <div class="card">
            <h3>Logs do Sistema</h3>
            <div id="logContainer" class="log-container">
                <div class="log-entry">Sistema iniciado - aguardando conex√£o...</div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>